CXX_STD = CXX17

# include and lib dirs (esp for cuda)
INC_PATH :=  -I../inst/include -I../src -I../../phydro/inst/include -I../../libpspm/include -isystem ../../phydro/inst/LBFGSpp/include

# flags
PKG_CXXFLAGS = -O3 -fPIC -std=c++17 -Wall -Wextra -DPHYDRO_ANALYTICAL_ONLY -DUSING_RCPP_PF

PKG_CXXFLAGS += -Wno-sign-compare -Wno-unused-variable \
-Wno-unused-but-set-variable -Wno-float-conversion \
-Wno-unused-parameter

PKG_CPPFLAGS = $(INC_PATH)

PKG_LIBS = -L../../libpspm/lib -lpspm

# SOURCES = $(wildcard src/*.cpp)

SOURCES = plant_geometry.cpp \
          assimilation.cpp \
          plant.cpp \
          light_environment.cpp \
          climate.cpp \
          pspm_interface.cpp \
          community_properties.cpp \
          state_restore.cpp \
          treelife.cpp \
          plantfate.cpp \
          r_interface.cpp

# Obtain the object files
OBJECTS=$(SOURCES:.cpp=.o) 

.PHONY: all libpspm

# Make the shared object
all: $(SHLIB)

$(SHLIB): libpspm

## This can be used in this way to build libpspm during package install
libpspm:
	(cd ../../libpspm && $(MAKE))

# Provide recipe to remove all objects
clean:
	@rm -f $(OBJECTS)
	(cd ../../libpspm && $(MAKE) clean)
	
